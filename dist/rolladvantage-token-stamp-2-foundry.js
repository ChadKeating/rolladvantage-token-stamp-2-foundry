!function(){"use strict";const e={getSavePath:()=>"worlds/"+game.world.name+"/rolladvantage",createDirectory:async()=>{var t=e.getSavePath(),a=await FilePicker.browse("data",t);console.dir(a),null!=a&&a.target==t||FilePicker.createDirectory("data",t)},render:async(e,a)=>{var o=a.find('.tab[data-tab="image"]').find(".form-group .form-fields").first();o.append("<button type='button' id='ra-ts2-open-button' title='Create Token' tabindex='-1'><img src='https://rolladvantage.com/assets/images/logo/default.png' /></button>"),o.find("#ra-ts2-open-button").click(e=>{e.preventDefault();const o=new t;o.render(!0),o.exportInputBox=a.find("input.image")})}};class t extends Application{static get defaultOptions(){const e=super.defaultOptions;return e.template="/modules/rolladvantage-token-stamp-2-foundry/templates/wrapper-template.html",e.resizable=!1,e.width=1216,e.height=650,e.classes=["ts2-wrapper"],e.title="Token Stamp 2 - RollAdvantage.com",e}static createTokenFile(e,t){for(var a=atob(e.split(",")[1]),o=[],r=0;r<a.length;r++)o.push(a.charCodeAt(r));var n=new Blob([new Uint8Array(o)],{type:"image/png"});return new File([n],t)}static async uploadToken(a,o){var r=t.createTokenFile(a,o);return await FilePicker.upload("data",e.getSavePath(),r,{})}async close(){return window.removeEventListener("message",this.foundryImportCallback.bind(this),!1),super.close()}foundryImportCallback(e){if("https://rolladvantage.com"==e.origin&&("sourceRegistered"==e.data.action&&(t.sourceRegistered=!0),"importToken"==e.data.action)){var a=this,o=Math.floor(Math.floor(1e8*(Date.now()/1e8-Math.floor(Date.now()/1e8)))/100);t.uploadToken(e.data.stampData,game.userId+"-"+o+".png").then(e=>{a.exportInputBox[0].value=e.path,a.close()})}}activateListeners(e){super.activateListeners(e);var a=this;window.addEventListener("message",this.foundryImportCallback.bind(this),!1),t.sourceRegistered=!1;var o=document.getElementById("ra-ts2-iframe").contentWindow;!function e(){t.sourceRegistered?console.log("Source Registered"):(o.postMessage({action:"registerSource"},"*"),a._element.length>0&&(console.log("Waiting for TS"),setTimeout(e,500)))}()}}Hooks.on("ready",()=>{const t=`renderTokenConfig${"pf1"===game.system.id?"PF":""}`;Hooks.on(t,e.render),e.createDirectory()})}();
//# sourceMappingURL=rolladvantage-token-stamp-2-foundry.js.map
